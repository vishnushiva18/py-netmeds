<html lang="en">

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script> -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>


    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <link rel="stylesheet" href="/static/nav-title.css">

    <link href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>

    <style>
        @media (min-width: 800px) {
            .wrapper {
                display: grid;
                grid-template-columns: 60px 1fr;
                grid-gap: 5px;
            }

            aside {
                align-self: start;
            }

            .card-body {
                flex: 1 1 auto;
                padding: 0 1.25rem 1.25rem 1.25rem;
            }

            td.number-value {
                text-align: center;
            }
        }
    </style>



    <title> </title>
    <style>
        /* tr:hover {background-color: papayawhip;cursor: pointer;} */

        .container {
            max-width: 100%;
            width: 100%;
        }
    </style>

</head>

<body data-new-gr-c-s-check-loaded="14.1020.0" data-gr-ext-installed="">
    <nav class="navbar navbar-expand-md navbar-light bg-light" style="display: block; margin-bottom: 5px;">
        <div class="row">
            <div class="col-sm-12">
                <div class="col-sm-3" style="float: left; padding-left: 0px; width: 225px; max-width: 225px;">
                    <a class="navbar-brand" href="#"
                        style="font-size: 24px;font-weight: 700;color: coral;float: left; padding: 0px;">Livetrack</a>
                </div>
                <div class="col-sm-1" style="float: right; width: auto;">
                    <a class="nav-user-img" href="#" id="navbarDropdownMenuLink2" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        <img src=" https://img.icons8.com/color/48/000000/administrator-male.png " alt=""
                            class="user-avatar-md rounded-circle">
                    </a>
                    <div class="dropdown-menu dropdown-menu-right nav-user-dropdown"
                        aria-labelledby="navbarDropdownMenuLink2">
                        <div class="nav-user-info">
                            <h5 class="mb-0 text-white nav-user-name"> Guest User </h5> <span
                                class="status"></span><span class="ml-2">Available</span>
                        </div>
                        <a class="dropdown-item" href="#"><i class="fas fa-user mr-2"></i>Profile</a>
                        <a class="dropdown-item" href="/csquare/logout"><i class="fas fa-power-off mr-2"></i>Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="container">

        <div id="main" style="margin-top: 10px;">
            <div class="row-firm-list">
                <select class="form-control select-firm" id="select-firm">
                    <option value="-">--Select--</option>

                    <option value="qgp/QoDCZHdHuTMaH4qkHqCxzP5BG1OSsgG4nZ/YLBU%3D">TEST - Erana</option>

                </select>
            </div>

            <div class="div-products" style="margin-top: 20px;">
                <div id="table-products_wrapper" class="dataTables_wrapper no-footer">
                    <table id="table-products" class="display dataTable1 no-footer"
                        style="text-align: center; width: 1460px;" aria-describedby="table-products_info">
                        <thead>
                            <tr>
                                <th style="text-align: center;"
                                    class="sorting sorting_asc" tabindex="0" aria-controls="table-products" rowspan="1"
                                    colspan="1" aria-label="Seq: activate to sort column descending"
                                    aria-sort="ascending">Seq</th>
                                <th style="text-align: center; " class="sorting"
                                    tabindex="0" aria-controls="table-products" rowspan="1" colspan="1"
                                    aria-label="Key: activate to sort column ascending">Key</th>
                                <th style="text-align: center;" class="sorting" tabindex="0"
                                    aria-controls="table-products" rowspan="1" colspan="1"
                                    aria-label="Product: activate to sort column ascending">Product</th>
                                <th style="text-align: center; " class="sorting"
                                    tabindex="0" aria-controls="table-products" rowspan="1" colspan="1"
                                    aria-label="Status: activate to sort column ascending">Status</th>
                                <th style="text-align: center; " class="sorting"
                                    tabindex="0" aria-controls="table-products" rowspan="1" colspan="1"
                                    aria-label="Last Login: activate to sort column ascending">Last Login</th>
                                <th style="text-align: center; " class="sorting"
                                    tabindex="0" aria-controls="table-products" rowspan="1" colspan="1"
                                    aria-label="Bill No.: activate to sort column ascending">Bill No.</th>
                                <th style="text-align: center; " class="sorting"
                                    tabindex="0" aria-controls="table-products" rowspan="1" colspan="1"
                                    aria-label="Bill Date: activate to sort column ascending">Bill Date</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-products" style="cursor: pointer;">
                            <tr class="odd">
                                <td class="sorting_1">1</td>
                                <td>D44K3</td>
                                <td>PHARMASSIST WOW CLIENT PACK</td>
                                <td>Pending</td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr class="even">
                                <td class="sorting_1">2</td>
                                <td>AV8QP</td>
                                <td>PHARMASSIST WOW EDITION</td>
                                <td>Pending</td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
            </div>

        </div>
        <!-- License Information modal -->
        <div class="modal" id="modal-lic-info" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content" style="border: double;">
                    <div id="folder-content" class="modal-body">
                        <div class="vertical-center">
                            <!-- <form action="form-arch"> -->
                            <div id="grp-bot-info" style="margin-bottom: 15px;">
                                <span style="font-weight: 700;">Key: </span> <span id="lic-key">NA</span><br>
                                <span style="font-weight: 700;">Product: </span> <span id="lic-product">NA</span><br>
                                <span style="font-weight: 700;">Status: </span> <span id="lic-status">NA</span><br>
                                <span style="font-weight: 700;">Bill No: </span> <span id="lic-bill-no">NA</span><br>
                                <span style="font-weight: 700;">Bill Date: </span> <span
                                    id="lic-bill-date">NA</span><br>
                                <span style="font-weight: 700;">Valid Till: </span> <span
                                    id="lic-valid-till">NA</span><br>
                                <span style="font-weight: 700;">Last Login: </span> <span
                                    id="lic-last-login">NA</span><br>
                                <span style="font-weight: 700;">Device ID: </span> <span id="lic-device-id">NA</span>
                            </div>
                            <div>
                                <button id="btn-lic-unregister" onclick="unregister()" class="btn btn-danger">Un
                                    Register</button>
                                <button id="btn-lic-generate-otp" onclick="generateOTP()"
                                    class="btn btn-success">Generate OTP</button>
                                <br>
                                <div id="lic-otp-msg">You OTP for Product Registration is <span id="lic-otp"
                                        style="font-size: large; font-weight: 900;">1234</span>, valid for 5 mins.</div>
                            </div>

                            <div class="input-group">
                                <!-- <span class="input-group-text arch-new-lbl" id="inputGroup-sizing-sm">Name</span> <input type="text" id="project_name" class="form-control" aria-label="Name of the project" aria-describedby="project-name"> -->
                            </div>

                            <div style="text-align: center; margin-top: 10px;">
                                <!-- <button class="btn btn-success" onclick="saveProject()" style="width: 100px;">Save</button> -->
                            </div>
                            <!-- </form> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End New Project modal -->

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->


    <script>
        licKey = null;
        $(document).ready(function () {
            var table = $('#table-products').DataTable({
                columnDefs: [
                    
                ],
            });

            $('#table-products tbody').on('click', 'tr', function () {
                var data = table.row(this).data();
                licKey = null;
                $.getJSON("/csq-lic/web/get-key-info?key=" + data[1], function (result) {
                    licKey = data[1];
                    console.log(result);
                    $("#lic-key").html(result.data.key);
                    $("#lic-product").html(result.data.prod_name);
                    $("#lic-status").html(result.data.c_status);
                    $("#lic-bill-no").html(result.data.bill_no);
                    $("#lic-bill-date").html(result.data.bill_date);
                    $("#lic-valid-till").html(result.data.valid_till);
                    $("#lic-last-login").html(result.data.last_active);
                    $("#lic-device-id").html(result.data.device_id);
                    if (result.data.c_status == "Pending") {
                        $('#btn-lic-unregister').hide();
                        $('#btn-lic-generate-otp').show();
                    } else {
                        $('#btn-lic-unregister').show();
                        $('#btn-lic-generate-otp').hide();
                    }
                    $('#lic-otp-msg').hide();
                    $("#modal-lic-info").modal("show");
                });


                // window.open("/csq-lic/web/product-lic-list?key" + data[1], "_blank");
                // alert('You clicked on ' + data[1] + "'s row");
            });
        });

        $(function () {
            $("#select-firm").change(function () {
                $("#table-products tbody").html("");
                var table = $('#table-products').DataTable();
                table.clear().draw();

                var selectedText = $(this).find("option:selected").text();
                var selectedValue = $(this).val();
                $.getJSON("/csq-lic/web/home/module-list?c2code=" + selectedValue, function (result) {
                    console.log(result);
                    $.each(result.data, function (i, v) {
                        table.row.add([i + 1, v.code, v.key, v.prod_name,
                        v.c_status, v.last_active, v.bill_no, v.bill_date]);
                    });

                    table.draw();
                });
            });
        });

        function generateOTP() {
            if (licKey == null) {
                return false;
            }

            $.getJSON("/csq-lic/web/get-otp?key=" + licKey, function (result) {
                console.log(result);
                $("#lic-otp").html(result.data);
                $('#lic-otp-msg').show();
            });
        }

        function unregister() {
            if (licKey == null) {
                return false;
            }

            $.getJSON("/csq-lic/web/unregister?key=" + licKey, function (result) {
                console.log(result);
                $("#lic-otp").html(result.data);
                $("#modal-lic-info").modal("hide");
            });
        }
    </script>


</body>

</html>